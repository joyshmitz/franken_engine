[
  {
    "id": "bd-3rjg",
    "title": "[PARSER-PHASE-3.5] Parallel parsing interference + determinism gate",
    "description": "## Change:\nAdd a dedicated interference/determinism gate for parallel parsing (`bd-1vfi`) that proves deterministic merge ordering, scheduler/seed reproducibility, and bounded serial-fallback behavior.\n\n## Hotspot evidence:\nParallel parser speedups can silently introduce nondeterministic AST ordering and flaky behavior that invalidate replay guarantees.\n\n## Mapped graveyard sections:\n- `alien_cs_graveyard.md` §0.25 (composability/interference matrix), §4.3 (deterministic multithreading), §0.14 (calibration/optional stopping guards)\n- `high_level_summary_of_frankensuite_planned_and_implemented_features_and_concepts.md` §0.16, §0.19, §0.20, §1969 (deterministic scheduling obligations)\n\n## EV score (Impact * Confidence * Reuse / Effort * Friction):\n(4 * 4 * 4) / (3 * 2) = 10.67\n\n## Priority tier:\nA\n\n## Adoption wedge:\nShip as a blocking verification sub-phase for parser parallel mode; parallel mode cannot be promoted until this gate is green.\n\n## Budgeted mode:\n- Max worker count cap\n- Max merge-buffer bytes\n- Max schedule-perturbation test iterations\n- Max cross-seed replay attempts\n- On exhaustion: force serial parser mode and mark parallel mode as non-promotable\n\n## Expected-loss model:\nStates:\n- `S_deterministic`: parallel path is deterministic\n- `S_nondeterministic_minor`: rare nondeterministic ordering with no semantic delta\n- `S_nondeterministic_major`: nondeterministic ordering or semantic drift\nActions:\n- `A_parallel_promote`, `A_parallel_hold`, `A_serial_fallback`\nLoss matrix:\n- `L(A_parallel_promote,S_nondeterministic_major)=150`\n- `L(A_parallel_promote,S_nondeterministic_minor)=50`\n- `L(A_parallel_hold,S_deterministic)=7`\n- `L(A_serial_fallback,S_deterministic)=3`\n\n## Calibration + fallback trigger:\n- Trigger serial fallback if deterministic hash mismatch across seeds/schedules is observed.\n- Trigger serial fallback if merge-order witness sequence differs for identical input+seed.\n- Trigger serial fallback if flake-rate exceeds configured bound over moving window.\n\n## Isomorphism proof plan:\n- Compare parallel AST hash against scalar reference and serial parser hash for each test case.\n- Record merge-order witness stream and require exact replay equivalence for repeated runs.\n- Include adversarial scheduler perturbation suite with deterministic replay obligations.\n\n## p50/p95/p99 before/after target:\n- p50 parse throughput >= 1.5x serial on large files\n- p95 throughput >= 1.3x serial\n- p99 throughput >= 1.2x serial\n- determinism mismatch rate = 0 on promotion suite\n\n## Primary failure risk + countermeasure:\nRisk: hidden nondeterminism from task scheduling or hash-map iteration.\nCountermeasure: deterministic task partitioning, stable sort/merge keys, ordered data structures in merge path, explicit seed transcript capture.\n\n## Repro artifact pack:\n- `artifacts/parser_parallel_interference/baseline.json`\n- `artifacts/parser_parallel_interference/interference_report.json`\n- `artifacts/parser_parallel_interference/seed_transcripts.jsonl`\n- `artifacts/parser_parallel_interference/golden_checksums.txt`\n- `artifacts/parser_parallel_interference/proof_note.md`\n- `artifacts/parser_parallel_interference/env.json`\n- `artifacts/parser_parallel_interference/manifest.json`\n- `artifacts/parser_parallel_interference/repro.lock`\n\n## Primary paper status (with checklist state):\nStatus: hypothesis\nChecklist:\n- [ ] Deterministic parallel merge literature review logged\n- [ ] Schedule perturbation methodology validated\n- [ ] False-positive/false-negative analysis completed\n- [ ] Promotion threshold rationale documented\n\n## Interference test status:\nRequired and blocking. Must include controller-composition interference report before promotion.\n\n## Demo linkage:\n- `demo_id`: `demo.parser.parallel_determinism`\n- `claim_id`: `claim.parser.parallel_speedup_without_drift`\n\n## Rollback:\nImmediate rollback to serial parser mode and disable parallel promotion token if any determinism gate fails.\n\n## Baseline comparator:\nSerial parser mode (`scalar_reference`) with identical corpus and seed policy.\n\n## Detailed sub-tasks:\n1. Define deterministic partitioning and merge witness schema.\n2. Implement scheduler perturbation harness.\n3. Implement cross-seed and cross-run equivalence checks.\n4. Add serial-fallback automatic trigger.\n5. Wire CI blocking gate and artifact emission.\n\n## User-outcome optimization addendum:\n- Interference gate output must be operator-actionable: include ranked root-cause hints, failing schedule IDs, and one-command repro instructions.\n- Classify nondeterminism incidents into merge-order, scheduler, data-structure iteration, and artifact-layer classes to speed remediation.\n- Keep promotion policy explicit: no ambiguous partial green states for parallel enablement.\n\n## Mandatory test and e2e contract:\n- Unit tests: witness comparator determinism, flake-rate calculator stability, trigger threshold math, scheduler perturbation primitives.\n- Integration tests: multi-seed and multi-schedule reproducibility, serial fallback enforcement, gate-state transitions.\n- E2E scripts with detailed logging:\n  - `scripts/e2e/parser_phase35_interference_smoke.sh`\n  - `scripts/e2e/parser_phase35_interference_scheduler_stress.sh`\n  - `scripts/e2e/parser_phase35_interference_fallback.sh`\n  - `scripts/e2e/parser_phase35_interference_replay.sh`\n- Logs must include: trace_id, run_id, input_hash, parser_mode, schedule_seed, schedule_id, worker_count, merge_witness_hash, determinism_delta, flake_rate, trigger_threshold, fallback_reason, outcome, error_code.\n\n## Granular TODO checklist:\n1. Define interference taxonomy and severity classes.\n2. Define deterministic scheduler perturbation protocol and seed catalog.\n3. Implement witness diff engine with stable minimization output.\n4. Implement flake-rate measurement with confidence windows.\n5. Implement deterministic threshold evaluator for fallback and hold actions.\n6. Implement automatic serial fallback tokening and promotion locks.\n7. Implement operator summary with ranked root-cause hints.\n8. Implement replay bundle generator for failing schedules and seeds.\n9. Add unit tests for trigger math, comparator, and taxonomy classifier.\n10. Add integration/e2e tests for stress perturbation, fallback, and replay determinism.\n11. Emit complete interference artifact bundle with checksums and manifests.\n12. Enforce fail-closed CI policy for any unresolved nondeterminism class.\n\n## Refinement pass 2: interference taxonomy depth + operator response speed\n- Expand interference classes to include timeout-cancellation race, backpressure ordering drift, and artifact-pipeline nondeterminism.\n- Require severity-indexed remediation playbook links in interference reports.\n- Add triage latency measurement so gate quality is evaluated by operator usability, not just detection accuracy.\n\n## Additional e2e scripts:\n- `scripts/e2e/parser_phase35_interference_timeout_race.sh`\n- `scripts/e2e/parser_phase35_interference_artifact_nondeterminism.sh`\n\n## Additional required log fields:\n- `schema_version`, `interference_class`, `interference_severity`, `triage_hint`, `triage_latency_ms`, `remediation_playbook_id`, `replay_command`\n\n## TODO extensions:\n13. Extend interference taxonomy for timeout, backpressure, and artifact-pipeline classes.\n14. Add severity-indexed remediation playbook mapping.\n15. Add triage-latency instrumentation to interference reports.\n16. Add deterministic artifact-pipeline nondeterminism detector.\n17. Add operator drill script validating one-command repro reliability.",
    "acceptance_criteria": "1. Interference gate proves deterministic behavior via stable merge witness streams across repeated seeded and schedule-perturbed runs.\n2. Comprehensive unit tests validate interference taxonomy (including timeout/backpressure/artifact classes), comparator determinism, flake-rate calculations, and threshold evaluation.\n3. Deterministic integration and end-to-end scripts cover normal, boundary, failure, and adversarial scheduler scenarios with replayable outcomes.\n4. Structured log assertions verify fields: schema_version, trace_id, run_id, input_hash, parser_mode, schedule_seed, schedule_id, worker_count, merge_witness_hash, determinism_delta, flake_rate, trigger_threshold, interference_class, interference_severity, triage_hint, triage_latency_ms, remediation_playbook_id, replay_command, fallback_reason, outcome, error_code.\n5. Automatic serial fallback and promotion-lock behavior are deterministic, test-covered, and reproducible.\n6. Interference artifact bundle includes machine evidence, operator summary, remediation links, and one-command replay instructions.\n7. CI promotion gate fails closed for any critical nondeterminism, unresolved high-severity interference class, or incomplete artifacts.\n8. Parallel mode is non-promotable until all interference classes are resolved with green deterministic reruns.",
    "status": "open",
    "priority": 1,
    "issue_type": "task",
    "assignee": "PearlTower",
    "created_at": "2026-02-24T00:59:08.563482426Z",
    "created_by": "ubuntu",
    "updated_at": "2026-02-24T11:25:06.917979562Z",
    "source_repo": ".",
    "compaction_level": 0,
    "original_size": 0,
    "dependencies": [
      {
        "id": "bd-2mds",
        "title": "Epic: Parser Frontier Program (active)",
        "status": "in_progress",
        "priority": 0,
        "dependency_type": "parent-child"
      },
      {
        "id": "bd-1vfi",
        "title": "[PARSER-PHASE-3] Parallel Parsing via asupersync Structured Concurrency",
        "status": "open",
        "priority": 1,
        "dependency_type": "blocks"
      }
    ],
    "dependents": [
      {
        "id": "bd-ntq",
        "title": "[10.2] VM Core - Comprehensive Execution Epic",
        "status": "open",
        "priority": 0,
        "dependency_type": "blocks"
      },
      {
        "id": "bd-1gfn",
        "title": "[PARSER-PHASE-4] Mathematical Error Recovery (Bayesian Diagnostics)",
        "status": "open",
        "priority": 1,
        "dependency_type": "blocks"
      },
      {
        "id": "bd-1csl",
        "title": "[PHASE-A] Native VM Substrate Exit Gate",
        "status": "in_progress",
        "priority": 1,
        "dependency_type": "blocks"
      }
    ],
    "comments": [
      {
        "id": 228,
        "issue_id": "bd-3rjg",
        "author": "Dicklesworthstone",
        "text": "## Verification Pass — parallel_interference_gate.rs\n\nAlready implemented (1326 lines, 42 tests, all passing). Fixed unused-import warning (ChunkPlan, ParityResult).\n\nAlso fixed pre-existing compile blocker in migration_kit.rs: `SchemaId::from_definition()` returns `SchemaId` directly, not `Result` — removed erroneous `.unwrap()` call.\n\nBead cannot close yet — blocked by bd-1vfi which is blocked by bd-drjd (FuchsiaWaterfall).\n",
        "created_at": "2026-02-24T11:23:46Z"
      },
      {
        "id": 229,
        "issue_id": "bd-3rjg",
        "author": "Dicklesworthstone",
        "text": "PearlTower: parallel_interference_gate.rs complete — 42 unit tests, all passing.\n\nModule proves deterministic merge ordering, scheduler/seed reproducibility, and\nbounded serial-fallback behavior for the parallel parser (bd-1vfi):\n\n- InterferenceClass enum (6 classes: MergeOrder, Scheduler, DataStructureIteration,\n  ArtifactPipeline, TimeoutRace, BackpressureDrift)\n- InterferenceSeverity (Info/Warning/Critical)\n- InterferenceIncident with triage hints, remediation playbook refs, replay commands\n- compare_witnesses() / compare_transcripts(): structured diff engine for merge witnesses\n- FlakeRate: fixed-point millionths measurement with configurable threshold\n- GateConfig: seed count, repeats, worker variations, flake threshold, serial parity\n- evaluate_gate(): multi-seed, multi-worker, multi-repeat stress evaluation\n  producing GateResult with decision (Promote/Hold/Reject), incidents, flake rate\n- OperatorSummary with ranked root-cause hints and recommended action\n- ReplayBundle: failing seed/worker catalog with one-command repro instructions\n- apply_gate_to_rollback(): integration with RollbackControl from parallel_parser\n\nAll types: serde Serialize/Deserialize, BTreeSet, no unsafe.\nGate correctly promotes when parallel parser is deterministic across all configurations.\n",
        "created_at": "2026-02-24T11:25:06Z"
      }
    ],
    "parent": "bd-2mds"
  }
]
